# t3.sh
# Get Single BOOKmark

# single argument (tag)

set +x
nb=$#

if [ $nb == 0 ]
then
	echo "error, you need to give a tag"
	echo ".open /home/sk/.mozilla/firefox/z7do02ft.default-release/places.sqlite" >temp_command
	echo "select title from moz_bookmarks where parent=4;" >>temp_command
	sqlite3 <temp_command >out0.txt
	nb=$(cat out0.txt | wc -l)
	echo "available tags: $nb"

	for a in $(cat out0.txt);
	do
		echo -n "$a - "
	done
	echo ""
	exit 1
fi

#echo "nb arg=$# arg=$1"

echo ".open /home/sk/.mozilla/firefox/z7do02ft.default-release/places.sqlite" >temp_command
echo "select id from moz_bookmarks where title='$1';" >>temp_command

sqlite3 <temp_command >out1.txt

index=$(cat out1.txt)
echo "index=$index"

echo ".open /home/sk/.mozilla/firefox/z7do02ft.default-release/places.sqlite" >temp_command
echo "select fk from moz_bookmarks where parent='$index';" >>temp_command
sqlite3 <temp_command >out2.txt


echo ".open /home/sk/.mozilla/firefox/z7do02ft.default-release/places.sqlite" >temp_command
for a in $(cat out2.txt);
do
#	echo $a
	echo "select url from moz_places where id='$a';" >>temp_command
done
sqlite3 <temp_command >out3.txt

fout=gsbook.html
echo -e "<html>\n<head>\n<title>gsbook output</title>" >$fout
echo -e "</head>\n<body>\n" >>$fout
echo -e "<h1>tag:$1</h1>\n" >>$fout
echo -e "<ul>\n" >>$fout
for link in $(cat out3.txt);
do
	echo -e "<li><a href='$link'>$link</a></li>\n" >>$fout
done
echo -e "</ul>\n</body>\n</html>" >>$fout
xdg-open $fout




